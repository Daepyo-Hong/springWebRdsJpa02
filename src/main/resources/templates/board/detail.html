<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        .edit-mode{
            display: none;
        }
        .flex{
            display: flex;
        }
        .reply-edit-mode{
            display: none;
        }

    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script th:inline="javascript">
        var bno = "[[${detail.bno}]]";
        $(function (){
            getReplies();

        });

        //ajax로 댓글 갖고오는 함수
        function getReplies() {
            $.get("/mybatis/boards/"+bno+"/replies",
                function(resp){
                    $("#display").html(resp);
                }
            );
        }
        //ajax로 댓글 등록
        function registReply(el){
            $.post("/mybatis/boards/"+bno+"/reply",
                {text:$("#text").val(), writer:$("#writer").val()},
                function(data,status,xhr){
                    console.log("처리결과: "+status);
                    if(status=="seccess"){
                        getReplies();
                    }
                    if(status=="error"){
                        alert("등록 실패!");
                    }
                }
            );
        }
        function showEitMode(){
            $(".edit-mode").show();
            $(".default-mode").hide();
        }
        function showDefaultMode() {
            $(".edit-mode").hide();
            $(".default-mode").show();
        }
        function confirmDelete() {
            return confirm("정말 삭제 하시겠습니까?");
        }

        function replyEditClicked(el){
            $(el).parents("tr").css("background-color","yellow").find(".reply-edit-mode").show();
            $(el).parents("tr").find(".reply-default-mode").hide();
        }
        function replyEditCancel(el){
            $(el).parents("tr").css("background-color","transparent").find(".reply-default-mode").show();
            $(el).parents("tr").find(".reply-edit-mode").hide();
        }
        function reEditProc(el){
            $(el).parents("tr").find(".re-edit-form").submit();
        }

    </script>
</head>
<body >
    <a href="/">HOME</a>
    <p>마이바티스 게시글 상세페이지</p>
    <form th:action="|/mybatis/boards/${detail.bno}|" method="post">
        <ul>
            <li>[[${detail.bno}]]</li>
            <li>[[${detail.writer}]]</li>
            <li>
                <div class="default-mode">[[${detail.title}]]</div>
                <div class="edit-mode"><input type="text" name="title" th:value="${detail.title}"></div>
            </li>
            <li>
                <div class="default-mode">[[${detail.content}]]</div>
                <div class="edit-mode">
                    <textarea rows="5" cols="60" name="content">[[${detail.content}]]</textarea>
                </div>
            </li>
            <li class="edit-mode">
                <input type="hidden" name="_method" value="PUT">
                <button type="submit">수정완료</button>
                <button type="button" onclick="showDefaultMode()">취소</button>
            </li>
        </ul>
    </form>
    <div class="default-mode flex">
        <button type="button" id="btn-edit" onclick="showEitMode()">수정</button>
        <form th:action="@{/mybatis/boards/{bno}(bno=${detail.bno})}" method="post" onsubmit="return confirmDelete()">
            <input type="hidden" name="_method" value="DELETE">
            <button type="submit">삭제</button>
        </form>
    </div>
    <hr>
    <section>
        <h1>댓글영역</h1>
        <div>
            <div>
                <input type="text" id="text" placeholder="댓글입력">
                <input type="hidden" id="writer" value="테스트">
                <button type="button" onclick="registReply(this)">등록</button>
            </div>
            <div id="display">댓글이 존재하지 않아요</div>

        </div>
    </section>

</body>
</html>